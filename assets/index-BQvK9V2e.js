import{r as h,j as e,c as k,L,H as N}from"./index-tdPHbA8R.js";const g=new Map;function M(t,r){const i=r?.serializer,[n]=h.useState(r?.defaultValue),[p]=h.useState(r?.defaultServerValue);return C(t,n,p,r?.storageSync,i?.parse,i?.stringify)}function C(t,r,i,n=!0,p=I,a=JSON.stringify){const c=h.useRef({string:null,parsed:void 0}),x=h.useSyncExternalStore(h.useCallback(d=>{const y=v=>{t===v&&d()};return D.add(y),()=>{D.delete(y)}},[t]),()=>{const d=K(()=>localStorage.getItem(t))??null;if(g.has(t))c.current.parsed=g.get(t);else if(d!==c.current.string){let y;try{y=d===null?r:p(d)}catch{y=r}c.current.parsed=y}return c.current.string=d,r!==void 0&&d===null&&K(()=>{const y=a(r);localStorage.setItem(t,y),c.current={string:y,parsed:r}}),c.current.parsed},()=>i??r),m=h.useCallback(d=>{const y=d instanceof Function?d(c.current.parsed):d;try{localStorage.setItem(t,a(y)),g.delete(t)}catch{g.set(t,y)}w(t)},[t,a]),f=h.useCallback(()=>{K(()=>localStorage.removeItem(t)),g.delete(t),w(t)},[t]);return h.useEffect(()=>{if(!n)return;const d=y=>{y.key===t&&y.storageArea===K(()=>localStorage)&&w(t)};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)},[t,n]),h.useMemo(()=>[x,m,{isPersistent:x===r||!g.has(t),removeItem:f}],[t,m,x,r,f])}const D=new Set;function w(t){for(const r of[...D])r(t)}function I(t){return t==="undefined"?void 0:JSON.parse(t)}function K(t){try{return t()}catch{}}const B="_mapManager_1jdi0_1",E="_mapButton_1jdi0_7",U="_mapListContainer_1jdi0_14",P="_mapList_1jdi0_14",O="_mapItem_1jdi0_41",A="_mapItemButton_1jdi0_50",R="_mapItemDeleteButton_1jdi0_58",T="_keyboard_1jdi0_77",z="_keyRow_1jdi0_83",F="_key_1jdi0_77",q="_keyUnknown_1jdi0_98",J="_keyDead_1jdi0_102",Y="_squareKey_1jdi0_106",H="_longKey_1jdi0_111",Q="_keyPressed_1jdi0_116",s={mapManager:B,mapButton:E,mapListContainer:U,mapList:P,mapItem:O,mapItemButton:A,mapItemDeleteButton:R,keyboard:T,keyRow:z,key:F,keyUnknown:q,keyDead:J,squareKey:Y,longKey:H,keyPressed:Q};function W({currentMap:t,setCurrentMap:r,addMap:i,deleteMap:n,maps:p}){return e.jsxs("div",{className:s.mapManager,children:[e.jsx("button",{className:s.mapButton,type:"button",onClick:a=>{a.target.focus()},children:t??"Select a map..."}),e.jsxs("div",{className:s.mapListContainer,children:[e.jsx("input",{type:"text",placeholder:"Add a new map (press Enter to confirm)",onKeyDown:a=>{a.key==="Enter"&&(i(a.target.value),a.target.value=""),a.stopPropagation()}}),e.jsx("ul",{className:s.mapList,children:p.map(a=>e.jsxs("li",{className:s.mapItem,children:[e.jsx("button",{type:"button",className:s.mapItemButton,onClick:c=>{r(a),c.target.blur()},children:a}),e.jsx("button",{type:"button",className:s.mapItemDeleteButton,onClick:()=>n(a),"aria-label":"Delete this map",children:"â€“"})]},a))})]})]})}function _({keys:t,keysPressed:r,keyboardMap:i,index:n}){return t.map(p=>{const a=i?.[p]?.[n];return e.jsx("span",{title:p,className:k(s.key,s.squareKey,r.includes(p)&&s.keyPressed,(a==null||a==="Unidentified")&&s.keyUnknown,a==="Dead"&&s.keyDead),children:["Dead","Unidentified"].includes(a)?null:a},p)})}function G({keyboardMap:t}){return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Key"}),e.jsx("th",{children:"Unmodified"}),e.jsx("th",{children:e.jsx("kbd",{children:"Shift"})}),e.jsx("th",{children:e.jsx("kbd",{children:"Alt"})}),e.jsxs("th",{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:"Alt"})]})]})}),e.jsx("tbody",{children:Object.entries(t).map(([r,i])=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("kbd",{children:r})}),i.map((n,p)=>e.jsx("td",{className:n==="Dead"?s.keyDead:n==="Unidentified"||!n?s.keyUnknown:void 0,children:n??"?"},p))]},r))})]})}function X({keyboardMap:t}){const r=[];for(const[i,n]of Object.entries(t))n[0]&&!["Unidentified","Dead"].includes(n[0])&&r.push([n[0],e.jsx("kbd",{children:i})]),n[1]&&!["Unidentified","Dead"].includes(n[1])&&r.push([n[1],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:i})]})]),n[2]&&!["Unidentified","Dead"].includes(n[2])&&r.push([n[2],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Alt"})," + ",e.jsx("kbd",{children:i})]})]),n[3]&&!["Unidentified","Dead"].includes(n[3])&&r.push([n[3],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:"Alt"})," + ",e.jsx("kbd",{children:i})]})]);return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Letter"}),e.jsx("th",{children:"Key"})]})}),e.jsx("tbody",{children:r.sort((i,n)=>i[0].localeCompare(n[0],"en-US")).map(([i,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:i}),e.jsx("td",{children:n})]},i))})]})}function $(){const[t,r]=h.useState(0),[i,n]=M("keyboardMaps",{defaultValue:{}}),[p,a]=h.useState(null),[c,x]=h.useState([]),[m,f]=h.useState(void 0),d=m===void 0?void 0:i[m];h.useEffect(()=>{const j=l=>{x(o=>[...o,l.code]),!["Backspace","CapsLock","ContextMenu","Control","Enter","Fn","Meta"," ","Tab"].includes(l.key)&&(l.key==="Shift"?r(o=>o===2?3:1):l.key==="Alt"?r(o=>o===1?3:2):n(o=>{if(a(null),!m)return a("No map selected"),o;if(!Object.hasOwn(o,m))return a("Unexpected: modifying an unknown key map"),o;const b=(l.shiftKey?1:0)+(l.altKey?2:0),S=o[m][l.code]?.[b];return S!=null&&S!==l.key?(a("You are modifying a key that is already mapped. Consider creating a new map."),o):(l.key==="Dead"&&a("Note: composite keys are not supported"),l.key==="Unidentified"&&a("Note: this key is not recognized by the browser"),o[m][l.code]??=[null,null,null,null],o[m][l.code][b]=l.key,{...o})}))},u=l=>{x(o=>o.filter(b=>b!==l.code)),l.key==="Shift"?r(o=>o===3?2:0):l.key==="Alt"&&r(o=>o===3?1:0)};return window.addEventListener("keydown",j),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",j),window.removeEventListener("keyup",u)}},[n,m]);const y=h.useCallback(j=>{n(u=>Object.hasOwn(u,j)?(a("Map already exists"),u):(u[j]={},{...u})),f(j)},[n]),v=h.useCallback(j=>{f(u=>{if(console.log(u,j),u!==j)return u;const[l,o]=Object.keys(i);return l===u?o:l}),n(u=>j&&Object.hasOwn(u,j)?(delete u[j],{...u}):(a("Unexpected: deleting an unknown key map"),u))},[i,n]);return e.jsxs("div",{children:[e.jsx("h1",{children:"Keyboard visualizer"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"1em"},children:[e.jsx(W,{currentMap:m,setCurrentMap:f,addMap:y,deleteMap:v,maps:Object.keys(i)}),e.jsx("div",{style:{color:"var(--color-red)"},children:p})]}),e.jsxs("div",{className:s.keyboard,children:[e.jsxs("div",{className:s.keyRow,children:[e.jsx(_,{keys:["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],index:t,keyboardMap:d,keysPressed:c}),e.jsx("span",{className:k(s.key,s.longKey,c.includes("Backspace")&&s.keyPressed),children:"Backspace"})]}),e.jsxs("div",{className:s.keyRow,children:[e.jsx("span",{className:k(s.key,s.longKey,c.includes("Tab")&&s.keyPressed),children:"Tab"}),e.jsx(_,{keys:["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],index:t,keyboardMap:d,keysPressed:c})]}),e.jsxs("div",{className:s.keyRow,children:[e.jsx("span",{className:k(s.key,s.longKey,c.includes("CapsLock")&&s.keyPressed),children:"Caps lock"}),e.jsx(_,{keys:["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],index:t,keyboardMap:d,keysPressed:c}),e.jsx("span",{className:k(s.key,s.longKey,c.includes("Enter")&&s.keyPressed),children:"Enter"})]}),e.jsxs("div",{className:s.keyRow,children:[e.jsx("span",{className:k(s.key,s.longKey,c.includes("ShiftLeft")&&s.keyPressed),children:"Shift"}),e.jsx(_,{keys:["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],index:t,keyboardMap:d,keysPressed:c}),e.jsx("span",{className:k(s.key,s.longKey,c.includes("ShiftRight")&&s.keyPressed),children:"Shift"})]})]}),e.jsxs("p",{children:["After creating or selecting a map, press any key to record its mapping. You can also hold ",e.jsx("kbd",{children:"Shift"})," or ",e.jsx("kbd",{children:"Option"})," to record those compound keys."]}),e.jsxs("p",{children:["The key codes displayed in ",e.jsx("code",{children:"<kbd>"})," (such as"," ",e.jsx("kbd",{children:"KeyA"}),") are"," ",e.jsx(L,{href:"https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code",children:"standard"})," ","codes, which typically correspond to the keys on a US keyboard. You can hover over any key in the diagram above to see its code."]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(N,{level:2,children:"Keyboard map"}),e.jsx(G,{keyboardMap:d}),e.jsx(N,{level:2,children:"Key search"}),e.jsx(X,{keyboardMap:d})]})]})}const V={title:"Keyboard visualizer",description:"A tool that visualizes your keyboard layout"};export{$ as default,V as meta};
