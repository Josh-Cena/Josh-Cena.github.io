import{r as h,j as e,c as k,L,H as D}from"./index-7KFMo8z5.js";const x=new Map;function M(t,s){if(h.useSyncExternalStore===void 0)throw new TypeError('You are using React 17 or below. Install with "npm install use-local-storage-state@17".');const[i]=h.useState(s?.defaultValue);if(typeof window>"u")return[i,()=>{},{isPersistent:!0,removeItem:()=>{}}];const n=s?.serializer;return C(t,i,s?.storageSync,n?.parse,n?.stringify)}function C(t,s,i=!0,n=I,m=JSON.stringify){!x.has(t)&&s!==void 0&&g(()=>localStorage.getItem(t))===null&&g(()=>localStorage.setItem(t,m(s)));const a=h.useRef({item:null,parsed:s}),y=h.useSyncExternalStore(h.useCallback(d=>{const c=p=>{t===p&&d()};return w.add(c),()=>{w.delete(c)}},[t]),()=>{var d;const c=(d=g(()=>localStorage.getItem(t)))!==null&&d!==void 0?d:null;if(x.has(t))a.current={item:c,parsed:x.get(t)};else if(c!==a.current.item){let p;try{p=c===null?s:n(c)}catch{p=s}a.current={item:c,parsed:p}}return a.current.parsed},()=>s),f=h.useCallback(d=>{const c=d instanceof Function?d(a.current.parsed):d;try{localStorage.setItem(t,m(c)),x.delete(t)}catch{x.set(t,c)}_(t)},[t,m]);return h.useEffect(()=>{if(!i)return;const d=c=>{c.storageArea===g(()=>localStorage)&&c.key===t&&_(t)};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)},[t,i]),h.useMemo(()=>[y,f,{isPersistent:y===s||!x.has(t),removeItem(){g(()=>localStorage.removeItem(t)),x.delete(t),_(t)}}],[t,f,y,s])}const w=new Set;function _(t){for(const s of[...w])s(t)}function I(t){return t==="undefined"?void 0:JSON.parse(t)}function g(t){try{return t()}catch{return}}const E="_mapManager_1jdi0_1",B="_mapButton_1jdi0_7",U="_mapListContainer_1jdi0_14",P="_mapList_1jdi0_14",O="_mapItem_1jdi0_41",A="_mapItemButton_1jdi0_50",R="_mapItemDeleteButton_1jdi0_58",T="_keyboard_1jdi0_77",z="_keyRow_1jdi0_83",F="_key_1jdi0_77",q="_keyUnknown_1jdi0_98",Y="_keyDead_1jdi0_102",J="_squareKey_1jdi0_106",H="_longKey_1jdi0_111",Q="_keyPressed_1jdi0_116",r={mapManager:E,mapButton:B,mapListContainer:U,mapList:P,mapItem:O,mapItemButton:A,mapItemDeleteButton:R,keyboard:T,keyRow:z,key:F,keyUnknown:q,keyDead:Y,squareKey:J,longKey:H,keyPressed:Q};function W({currentMap:t,setCurrentMap:s,addMap:i,deleteMap:n,maps:m}){return e.jsxs("div",{className:r.mapManager,children:[e.jsx("button",{className:r.mapButton,type:"button",onClick:a=>{a.target.focus()},children:t??"Select a map..."}),e.jsxs("div",{className:r.mapListContainer,children:[e.jsx("input",{type:"text",placeholder:"Add a new map (press Enter to confirm)",onKeyDown:a=>{a.key==="Enter"&&(i(a.target.value),a.target.value=""),a.stopPropagation()}}),e.jsx("ul",{className:r.mapList,children:m.map(a=>e.jsxs("li",{className:r.mapItem,children:[e.jsx("button",{type:"button",className:r.mapItemButton,onClick:y=>{s(a),y.target.blur()},children:a}),e.jsx("button",{type:"button",className:r.mapItemDeleteButton,onClick:()=>n(a),"aria-label":"Delete this map",children:"â€“"})]},a))})]})]})}function K({keys:t,keysPressed:s,keyboardMap:i,index:n}){return t.map(m=>{const a=i?.[m]?.[n];return e.jsx("span",{title:m,className:k(r.key,r.squareKey,s.includes(m)&&r.keyPressed,(a==null||a==="Unidentified")&&r.keyUnknown,a==="Dead"&&r.keyDead),children:["Dead","Unidentified"].includes(a)?null:a},m)})}function G({keyboardMap:t}){return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Key"}),e.jsx("th",{children:"Unmodified"}),e.jsx("th",{children:e.jsx("kbd",{children:"Shift"})}),e.jsx("th",{children:e.jsx("kbd",{children:"Alt"})}),e.jsxs("th",{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:"Alt"})]})]})}),e.jsx("tbody",{children:Object.entries(t).map(([s,i])=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("kbd",{children:s})}),i.map((n,m)=>e.jsx("td",{className:n==="Dead"?r.keyDead:n==="Unidentified"||!n?r.keyUnknown:void 0,children:n??"?"},m))]},s))})]})}function X({keyboardMap:t}){const s=[];for(const[i,n]of Object.entries(t))n[0]&&!["Unidentified","Dead"].includes(n[0])&&s.push([n[0],e.jsx("kbd",{children:i})]),n[1]&&!["Unidentified","Dead"].includes(n[1])&&s.push([n[1],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:i})]})]),n[2]&&!["Unidentified","Dead"].includes(n[2])&&s.push([n[2],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Alt"})," + ",e.jsx("kbd",{children:i})]})]),n[3]&&!["Unidentified","Dead"].includes(n[3])&&s.push([n[3],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:"Alt"})," + ",e.jsx("kbd",{children:i})]})]);return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Letter"}),e.jsx("th",{children:"Key"})]})}),e.jsx("tbody",{children:s.sort((i,n)=>i[0].localeCompare(n[0],"en-US")).map(([i,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:i}),e.jsx("td",{children:n})]},i))})]})}function $(){const[t,s]=h.useState(0),[i,n]=M("keyboardMaps",{defaultValue:{}}),[m,a]=h.useState(null),[y,f]=h.useState([]),[d,c]=h.useState(void 0),p=d===void 0?void 0:i[d];h.useEffect(()=>{const j=l=>{f(o=>[...o,l.code]),!["Backspace","CapsLock","ContextMenu","Control","Enter","Fn","Meta"," ","Tab"].includes(l.key)&&(l.key==="Shift"?s(o=>o===2?3:1):l.key==="Alt"?s(o=>o===1?3:2):n(o=>{if(a(null),!d)return a("No map selected"),o;if(!Object.hasOwn(o,d))return a("Unexpected: modifying an unknown key map"),o;const b=(l.shiftKey?1:0)+(l.altKey?2:0),v=o[d][l.code]?.[b];return v!=null&&v!==l.key?(a("You are modifying a key that is already mapped. Consider creating a new map."),o):(l.key==="Dead"&&a("Note: composite keys are not supported"),l.key==="Unidentified"&&a("Note: this key is not recognized by the browser"),o[d][l.code]??=[null,null,null,null],o[d][l.code][b]=l.key,{...o})}))},u=l=>{f(o=>o.filter(b=>b!==l.code)),l.key==="Shift"?s(o=>o===3?2:0):l.key==="Alt"&&s(o=>o===3?1:0)};return window.addEventListener("keydown",j),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",j),window.removeEventListener("keyup",u)}},[n,d]);const S=h.useCallback(j=>{n(u=>Object.hasOwn(u,j)?(a("Map already exists"),u):(u[j]={},{...u})),c(j)},[n]),N=h.useCallback(j=>{c(u=>{if(console.log(u,j),u!==j)return u;const[l,o]=Object.keys(i);return l===u?o:l}),n(u=>j&&Object.hasOwn(u,j)?(delete u[j],{...u}):(a("Unexpected: deleting an unknown key map"),u))},[i,n]);return e.jsxs("div",{children:[e.jsx("h1",{children:"Keyboard visualizer"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"1em"},children:[e.jsx(W,{currentMap:d,setCurrentMap:c,addMap:S,deleteMap:N,maps:Object.keys(i)}),e.jsx("div",{style:{color:"var(--color-red)"},children:m})]}),e.jsxs("div",{className:r.keyboard,children:[e.jsxs("div",{className:r.keyRow,children:[e.jsx(K,{keys:["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],index:t,keyboardMap:p,keysPressed:y}),e.jsx("span",{className:k(r.key,r.longKey,y.includes("Backspace")&&r.keyPressed),children:"Backspace"})]}),e.jsxs("div",{className:r.keyRow,children:[e.jsx("span",{className:k(r.key,r.longKey,y.includes("Tab")&&r.keyPressed),children:"Tab"}),e.jsx(K,{keys:["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],index:t,keyboardMap:p,keysPressed:y})]}),e.jsxs("div",{className:r.keyRow,children:[e.jsx("span",{className:k(r.key,r.longKey,y.includes("CapsLock")&&r.keyPressed),children:"Caps lock"}),e.jsx(K,{keys:["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],index:t,keyboardMap:p,keysPressed:y}),e.jsx("span",{className:k(r.key,r.longKey,y.includes("Enter")&&r.keyPressed),children:"Enter"})]}),e.jsxs("div",{className:r.keyRow,children:[e.jsx("span",{className:k(r.key,r.longKey,y.includes("ShiftLeft")&&r.keyPressed),children:"Shift"}),e.jsx(K,{keys:["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],index:t,keyboardMap:p,keysPressed:y}),e.jsx("span",{className:k(r.key,r.longKey,y.includes("ShiftRight")&&r.keyPressed),children:"Shift"})]})]}),e.jsxs("p",{children:["After creating or selecting a map, press any key to record its mapping. You can also hold ",e.jsx("kbd",{children:"Shift"})," or ",e.jsx("kbd",{children:"Option"})," to record those compound keys."]}),e.jsxs("p",{children:["The key codes displayed in ",e.jsx("code",{children:"<kbd>"})," (such as"," ",e.jsx("kbd",{children:"KeyA"}),") are"," ",e.jsx(L,{href:"https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code",children:"standard"})," ","codes, which typically correspond to the keys on a US keyboard. You can hover over any key in the diagram above to see its code."]}),p&&e.jsxs(e.Fragment,{children:[e.jsx(D,{level:2,children:"Keyboard map"}),e.jsx(G,{keyboardMap:p}),e.jsx(D,{level:2,children:"Key search"}),e.jsx(X,{keyboardMap:p})]})]})}const V={title:"Keyboard visualizer",description:"A tool that visualizes your keyboard layout"};export{$ as default,V as meta};
