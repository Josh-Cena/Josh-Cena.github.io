import{r as p,j as e,c as x,L,H as D}from"./index-DbwhWtYf.js";const k=new Map;function M(t,s){const[a]=p.useState(s?.defaultValue);if(typeof window>"u")return[a,()=>{},{isPersistent:!0,removeItem:()=>{}}];const n=s?.serializer;return C(t,a,s?.storageSync,n?.parse,n?.stringify)}function C(t,s,a=!0,n=I,h=JSON.stringify){!k.has(t)&&s!==void 0&&b(()=>localStorage.getItem(t))===null&&b(()=>localStorage.setItem(t,h(s)));const i=p.useRef({item:null,parsed:s}),y=p.useSyncExternalStore(p.useCallback(d=>{const l=m=>{t===m&&d()};return w.add(l),()=>{w.delete(l)}},[t]),()=>{var d;const l=(d=b(()=>localStorage.getItem(t)))!==null&&d!==void 0?d:null;if(k.has(t))i.current={item:l,parsed:k.get(t)};else if(l!==i.current.item){let m;try{m=l===null?s:n(l)}catch{m=s}i.current={item:l,parsed:m}}return i.current.parsed},()=>s),f=p.useCallback(d=>{const l=d instanceof Function?d(i.current.parsed):d;try{localStorage.setItem(t,h(l)),k.delete(t)}catch{k.set(t,l)}_(t)},[t,h]);return p.useEffect(()=>{if(!a)return;const d=l=>{l.storageArea===b(()=>localStorage)&&l.key===t&&_(t)};return window.addEventListener("storage",d),()=>window.removeEventListener("storage",d)},[t,a]),p.useMemo(()=>[y,f,{isPersistent:y===s||!k.has(t),removeItem(){b(()=>localStorage.removeItem(t)),k.delete(t),_(t)}}],[t,f,y,s])}const w=new Set;function _(t){for(const s of[...w])s(t)}function I(t){return t==="undefined"?void 0:JSON.parse(t)}function b(t){try{return t()}catch{return}}const B="_mapManager_1jdi0_1",E="_mapButton_1jdi0_7",U="_mapListContainer_1jdi0_14",P="_mapList_1jdi0_14",O="_mapItem_1jdi0_41",A="_mapItemButton_1jdi0_50",R="_mapItemDeleteButton_1jdi0_58",T="_keyboard_1jdi0_77",z="_keyRow_1jdi0_83",F="_key_1jdi0_77",q="_keyUnknown_1jdi0_98",J="_keyDead_1jdi0_102",Y="_squareKey_1jdi0_106",H="_longKey_1jdi0_111",Q="_keyPressed_1jdi0_116",r={mapManager:B,mapButton:E,mapListContainer:U,mapList:P,mapItem:O,mapItemButton:A,mapItemDeleteButton:R,keyboard:T,keyRow:z,key:F,keyUnknown:q,keyDead:J,squareKey:Y,longKey:H,keyPressed:Q};function W({currentMap:t,setCurrentMap:s,addMap:a,deleteMap:n,maps:h}){return e.jsxs("div",{className:r.mapManager,children:[e.jsx("button",{className:r.mapButton,type:"button",onClick:i=>{i.target.focus()},children:t??"Select a map..."}),e.jsxs("div",{className:r.mapListContainer,children:[e.jsx("input",{type:"text",placeholder:"Add a new map (press Enter to confirm)",onKeyDown:i=>{i.key==="Enter"&&(a(i.target.value),i.target.value=""),i.stopPropagation()}}),e.jsx("ul",{className:r.mapList,children:h.map(i=>e.jsxs("li",{className:r.mapItem,children:[e.jsx("button",{type:"button",className:r.mapItemButton,onClick:y=>{s(i),y.target.blur()},children:i}),e.jsx("button",{type:"button",className:r.mapItemDeleteButton,onClick:()=>n(i),"aria-label":"Delete this map",children:"â€“"})]},i))})]})]})}function K({keys:t,keysPressed:s,keyboardMap:a,index:n}){return t.map(h=>{const i=a?.[h]?.[n];return e.jsx("span",{title:h,className:x(r.key,r.squareKey,s.includes(h)&&r.keyPressed,(i==null||i==="Unidentified")&&r.keyUnknown,i==="Dead"&&r.keyDead),children:["Dead","Unidentified"].includes(i)?null:i},h)})}function G({keyboardMap:t}){return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Key"}),e.jsx("th",{children:"Unmodified"}),e.jsx("th",{children:e.jsx("kbd",{children:"Shift"})}),e.jsx("th",{children:e.jsx("kbd",{children:"Alt"})}),e.jsxs("th",{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:"Alt"})]})]})}),e.jsx("tbody",{children:Object.entries(t).map(([s,a])=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("kbd",{children:s})}),a.map((n,h)=>e.jsx("td",{className:n==="Dead"?r.keyDead:n==="Unidentified"||!n?r.keyUnknown:void 0,children:n??"?"},h))]},s))})]})}function X({keyboardMap:t}){const s=[];for(const[a,n]of Object.entries(t))n[0]&&!["Unidentified","Dead"].includes(n[0])&&s.push([n[0],e.jsx("kbd",{children:a})]),n[1]&&!["Unidentified","Dead"].includes(n[1])&&s.push([n[1],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:a})]})]),n[2]&&!["Unidentified","Dead"].includes(n[2])&&s.push([n[2],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Alt"})," + ",e.jsx("kbd",{children:a})]})]),n[3]&&!["Unidentified","Dead"].includes(n[3])&&s.push([n[3],e.jsxs(e.Fragment,{children:[e.jsx("kbd",{children:"Shift"})," + ",e.jsx("kbd",{children:"Alt"})," + ",e.jsx("kbd",{children:a})]})]);return e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Letter"}),e.jsx("th",{children:"Key"})]})}),e.jsx("tbody",{children:s.sort((a,n)=>a[0].localeCompare(n[0],"en-US")).map(([a,n])=>e.jsxs("tr",{children:[e.jsx("td",{children:a}),e.jsx("td",{children:n})]},a))})]})}function $(){const[t,s]=p.useState(0),[a,n]=M("keyboardMaps",{defaultValue:{}}),[h,i]=p.useState(null),[y,f]=p.useState([]),[d,l]=p.useState(void 0),m=d===void 0?void 0:a[d];p.useEffect(()=>{const j=c=>{f(o=>[...o,c.code]),!["Backspace","CapsLock","ContextMenu","Control","Enter","Fn","Meta"," ","Tab"].includes(c.key)&&(c.key==="Shift"?s(o=>o===2?3:1):c.key==="Alt"?s(o=>o===1?3:2):n(o=>{if(i(null),!d)return i("No map selected"),o;if(!Object.hasOwn(o,d))return i("Unexpected: modifying an unknown key map"),o;const g=(c.shiftKey?1:0)+(c.altKey?2:0),v=o[d][c.code]?.[g];return v!=null&&v!==c.key?(i("You are modifying a key that is already mapped. Consider creating a new map."),o):(c.key==="Dead"&&i("Note: composite keys are not supported"),c.key==="Unidentified"&&i("Note: this key is not recognized by the browser"),o[d][c.code]??=[null,null,null,null],o[d][c.code][g]=c.key,{...o})}))},u=c=>{f(o=>o.filter(g=>g!==c.code)),c.key==="Shift"?s(o=>o===3?2:0):c.key==="Alt"&&s(o=>o===3?1:0)};return window.addEventListener("keydown",j),window.addEventListener("keyup",u),()=>{window.removeEventListener("keydown",j),window.removeEventListener("keyup",u)}},[n,d]);const S=p.useCallback(j=>{n(u=>Object.hasOwn(u,j)?(i("Map already exists"),u):(u[j]={},{...u})),l(j)},[n]),N=p.useCallback(j=>{l(u=>{if(console.log(u,j),u!==j)return u;const[c,o]=Object.keys(a);return c===u?o:c}),n(u=>j&&Object.hasOwn(u,j)?(delete u[j],{...u}):(i("Unexpected: deleting an unknown key map"),u))},[a,n]);return e.jsxs("div",{children:[e.jsx("h1",{children:"Keyboard visualizer"}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:"1em"},children:[e.jsx(W,{currentMap:d,setCurrentMap:l,addMap:S,deleteMap:N,maps:Object.keys(a)}),e.jsx("div",{style:{color:"var(--color-red)"},children:h})]}),e.jsxs("div",{className:r.keyboard,children:[e.jsxs("div",{className:r.keyRow,children:[e.jsx(K,{keys:["Backquote","Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0","Minus","Equal"],index:t,keyboardMap:m,keysPressed:y}),e.jsx("span",{className:x(r.key,r.longKey,y.includes("Backspace")&&r.keyPressed),children:"Backspace"})]}),e.jsxs("div",{className:r.keyRow,children:[e.jsx("span",{className:x(r.key,r.longKey,y.includes("Tab")&&r.keyPressed),children:"Tab"}),e.jsx(K,{keys:["KeyQ","KeyW","KeyE","KeyR","KeyT","KeyY","KeyU","KeyI","KeyO","KeyP","BracketLeft","BracketRight","Backslash"],index:t,keyboardMap:m,keysPressed:y})]}),e.jsxs("div",{className:r.keyRow,children:[e.jsx("span",{className:x(r.key,r.longKey,y.includes("CapsLock")&&r.keyPressed),children:"Caps lock"}),e.jsx(K,{keys:["KeyA","KeyS","KeyD","KeyF","KeyG","KeyH","KeyJ","KeyK","KeyL","Semicolon","Quote"],index:t,keyboardMap:m,keysPressed:y}),e.jsx("span",{className:x(r.key,r.longKey,y.includes("Enter")&&r.keyPressed),children:"Enter"})]}),e.jsxs("div",{className:r.keyRow,children:[e.jsx("span",{className:x(r.key,r.longKey,y.includes("ShiftLeft")&&r.keyPressed),children:"Shift"}),e.jsx(K,{keys:["KeyZ","KeyX","KeyC","KeyV","KeyB","KeyN","KeyM","Comma","Period","Slash"],index:t,keyboardMap:m,keysPressed:y}),e.jsx("span",{className:x(r.key,r.longKey,y.includes("ShiftRight")&&r.keyPressed),children:"Shift"})]})]}),e.jsxs("p",{children:["After creating or selecting a map, press any key to record its mapping. You can also hold ",e.jsx("kbd",{children:"Shift"})," or ",e.jsx("kbd",{children:"Option"})," to record those compound keys."]}),e.jsxs("p",{children:["The key codes displayed in ",e.jsx("code",{children:"<kbd>"})," (such as"," ",e.jsx("kbd",{children:"KeyA"}),") are"," ",e.jsx(L,{href:"https://developer.mozilla.org/en-US/docs/Web/API/KeyboardEvent/code",children:"standard"})," ","codes, which typically correspond to the keys on a US keyboard. You can hover over any key in the diagram above to see its code."]}),m&&e.jsxs(e.Fragment,{children:[e.jsx(D,{level:2,children:"Keyboard map"}),e.jsx(G,{keyboardMap:m}),e.jsx(D,{level:2,children:"Key search"}),e.jsx(X,{keyboardMap:m})]})]})}const V={title:"Keyboard visualizer",description:"A tool that visualizes your keyboard layout"};export{$ as default,V as meta};
