import{u as i,j as s}from"./index-CYq-bCfF.js";import{P as t,a as r}from"./_components-DytvGw39.js";import"./_commonjsHelpers-Cpj98o6Y.js";const n={tags:["Puzzle","Constraint satisfaction","Manual inspection"],title:"Advent of Code 2024 - Day 24: Crossed Wires",description:"Advent of Code 2024 - Day 24: Crossed Wires, a problem that involves Puzzle, Constraint satisfaction, and Manual inspection. Solution written in OCaml, with detailed walkthrough and proof.",year:2024,day:24};function l(a){const e={a:"a",annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",mstyle:"mstyle",msub:"msub",mtable:"mtable",mtd:"mtd",mtr:"mtr",p:"p",pre:"pre",semantics:"semantics",span:"span",ul:"ul",...i(),...a.components};return s.jsxs(s.Fragment,{children:[s.jsxs(e.h1,{children:["Advent of Code 2024 - Day 24",s.jsx(e.span,{className:"subtitle",children:"Crossed Wires"})]}),`
`,`
`,s.jsx(t,{frontMatter:n}),`
`,s.jsxs(e.p,{children:["This problem pays tribute to ",s.jsx(e.a,{href:"/notes/aoc/2022/23/",children:"2022 day 23"}),"."]}),`
`,s.jsx(e.h2,{children:"Part 1"}),`
`,s.jsxs(e.p,{children:["On realizing that the circuit isn't ",s.jsx(e.em,{children:"strictly"})," a tree but more like a graph where each node can have multiple inputs and outputs (identical ones but going to different places), I decided to not parse the circuit as a tree, but just as a map instead. I can still do recursive evaluation, and I can also easily memoize the results of each gate, which saves some time reevaluating the same gate for different output bits."]}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-ocaml",children:`let rec eval_gate values gates name =
  if Hashtbl.mem values name then Hashtbl.find values name
  else
    let (x, op, y) = Hashtbl.find gates name in
    let x_val = eval_gate values gates x in
    let y_val = eval_gate values gates y in
    let result =
      match op with
      | "AND" -> x_val && y_val
      | "OR" -> x_val || y_val
      | "XOR" -> x_val <> y_val
      | _ -> failwith "Invalid operator"
    in
    Hashtbl.add values name result;
    result
`})}),`
`,s.jsxs(e.p,{children:["Initially ",s.jsx(e.code,{children:"values"})," just contains the input bits; it gets populated as we evaluate the gates, and the same gate is never recomputed."]}),`
`,s.jsx(e.h2,{children:"Part 2"}),`
`,s.jsxs(e.p,{children:["Conceptually, a full adder takes inputs ",s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:s.jsxs(e.semantics,{children:[s.jsx(e.mrow,{children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"A"}),s.jsx(e.mi,{children:"i"})]})}),s.jsx(e.annotation,{encoding:"application/x-tex",children:"A_i"})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",children:"A"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]})]})})]}),", ",s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:s.jsxs(e.semantics,{children:[s.jsx(e.mrow,{children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"B"}),s.jsx(e.mi,{children:"i"})]})}),s.jsx(e.annotation,{encoding:"application/x-tex",children:"B_i"})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0502em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]})]})})]}),", and ",s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:s.jsxs(e.semantics,{children:[s.jsx(e.mrow,{children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"C"}),s.jsxs(e.mrow,{children:[s.jsx(e.mi,{children:"i"}),s.jsx(e.mo,{children:"−"}),s.jsx(e.mn,{children:"1"})]})]})}),s.jsx(e.annotation,{encoding:"application/x-tex",children:"C_{i-1}"})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"0.8917em",verticalAlign:"-0.2083em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsxs(e.span,{className:"mord mtight",children:[s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"}),s.jsx(e.span,{className:"mbin mtight",children:"−"}),s.jsx(e.span,{className:"mord mtight",children:"1"})]})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.2083em"},children:s.jsx(e.span,{})})})]})})]})]})})]}),", and produces outputs ",s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:s.jsxs(e.semantics,{children:[s.jsx(e.mrow,{children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"S"}),s.jsx(e.mi,{children:"i"})]})}),s.jsx(e.annotation,{encoding:"application/x-tex",children:"S_i"})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"S"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0576em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]})]})})]})," and ",s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:s.jsxs(e.semantics,{children:[s.jsx(e.mrow,{children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"C"}),s.jsx(e.mi,{children:"i"})]})}),s.jsx(e.annotation,{encoding:"application/x-tex",children:"C_i"})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"0.8333em",verticalAlign:"-0.15em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]})]})})]}),", as follows:"]}),`
`,s.jsx(e.span,{className:"katex-display",children:s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:s.jsxs(e.semantics,{children:[s.jsxs(e.mtable,{rowspacing:"0.25em",columnalign:"right left",columnspacing:"0em",children:[s.jsxs(e.mtr,{children:[s.jsx(e.mtd,{children:s.jsx(e.mstyle,{scriptlevel:"0",displaystyle:"true",children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"S"}),s.jsx(e.mi,{children:"i"})]})})}),s.jsx(e.mtd,{children:s.jsx(e.mstyle,{scriptlevel:"0",displaystyle:"true",children:s.jsxs(e.mrow,{children:[s.jsx(e.mrow,{}),s.jsx(e.mo,{children:"="}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"A"}),s.jsx(e.mi,{children:"i"})]}),s.jsx(e.mo,{children:"⊕"}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"B"}),s.jsx(e.mi,{children:"i"})]}),s.jsx(e.mo,{children:"⊕"}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"C"}),s.jsxs(e.mrow,{children:[s.jsx(e.mi,{children:"i"}),s.jsx(e.mo,{children:"−"}),s.jsx(e.mn,{children:"1"})]})]})]})})})]}),s.jsxs(e.mtr,{children:[s.jsx(e.mtd,{children:s.jsx(e.mstyle,{scriptlevel:"0",displaystyle:"true",children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"C"}),s.jsx(e.mi,{children:"i"})]})})}),s.jsx(e.mtd,{children:s.jsx(e.mstyle,{scriptlevel:"0",displaystyle:"true",children:s.jsxs(e.mrow,{children:[s.jsx(e.mrow,{}),s.jsx(e.mo,{children:"="}),s.jsx(e.mo,{stretchy:"false",children:"("}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"A"}),s.jsx(e.mi,{children:"i"})]}),s.jsx(e.mo,{children:"∧"}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"B"}),s.jsx(e.mi,{children:"i"})]}),s.jsx(e.mo,{stretchy:"false",children:")"}),s.jsx(e.mo,{children:"∨"}),s.jsx(e.mo,{stretchy:"false",children:"("}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"C"}),s.jsxs(e.mrow,{children:[s.jsx(e.mi,{children:"i"}),s.jsx(e.mo,{children:"−"}),s.jsx(e.mn,{children:"1"})]})]}),s.jsx(e.mo,{children:"∧"}),s.jsx(e.mo,{stretchy:"false",children:"("}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"A"}),s.jsx(e.mi,{children:"i"})]}),s.jsx(e.mo,{children:"⊕"}),s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"B"}),s.jsx(e.mi,{children:"i"})]}),s.jsx(e.mo,{stretchy:"false",children:")"}),s.jsx(e.mo,{stretchy:"false",children:")"})]})})})]})]}),s.jsx(e.annotation,{encoding:"application/x-tex",children:`\\begin{aligned}
S_i &= A_i \\oplus B_i \\oplus C_{i-1} \\\\
C_i &= (A_i \\land B_i) \\lor (C_{i-1} \\land (A_i \\oplus B_i))
\\end{aligned}`})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"3em",verticalAlign:"-1.25em"}}),s.jsx(e.span,{className:"mord",children:s.jsxs(e.span,{className:"mtable",children:[s.jsx(e.span,{className:"col-align-r",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsxs(e.span,{className:"vlist",style:{height:"1.75em"},children:[s.jsxs(e.span,{style:{top:"-3.91em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"3em"}}),s.jsx(e.span,{className:"mord",children:s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"S"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0576em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]})})]}),s.jsxs(e.span,{style:{top:"-2.41em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"3em"}}),s.jsx(e.span,{className:"mord",children:s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]})})]})]}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"1.25em"},children:s.jsx(e.span,{})})})]})}),s.jsx(e.span,{className:"col-align-l",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsxs(e.span,{className:"vlist",style:{height:"1.75em"},children:[s.jsxs(e.span,{style:{top:"-3.91em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"3em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),s.jsx(e.span,{className:"mrel",children:"="}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",children:"A"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mbin",children:"⊕"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0502em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mbin",children:"⊕"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsxs(e.span,{className:"mord mtight",children:[s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"}),s.jsx(e.span,{className:"mbin mtight",children:"−"}),s.jsx(e.span,{className:"mord mtight",children:"1"})]})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.2083em"},children:s.jsx(e.span,{})})})]})})]})]})]}),s.jsxs(e.span,{style:{top:"-2.41em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"3em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),s.jsx(e.span,{className:"mrel",children:"="}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2778em"}}),s.jsx(e.span,{className:"mopen",children:"("}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",children:"A"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mbin",children:"∧"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0502em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mclose",children:")"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mbin",children:"∨"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mopen",children:"("}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsxs(e.span,{className:"mord mtight",children:[s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"}),s.jsx(e.span,{className:"mbin mtight",children:"−"}),s.jsx(e.span,{className:"mord mtight",children:"1"})]})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.2083em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mbin",children:"∧"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mopen",children:"("}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",children:"A"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsx(e.span,{className:"mbin",children:"⊕"}),s.jsx(e.span,{className:"mspace",style:{marginRight:"0.2222em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.05017em"},children:"B"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3117em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0502em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsx(e.span,{className:"mord mathnormal mtight",children:"i"})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.15em"},children:s.jsx(e.span,{})})})]})})]}),s.jsx(e.span,{className:"mclose",children:"))"})]})]})]}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"1.25em"},children:s.jsx(e.span,{})})})]})})]})})]})})]})}),`
`,s.jsxs(e.p,{children:["A half adder does not have a carry input, which means that ",s.jsxs(e.span,{className:"katex",children:[s.jsx(e.span,{className:"katex-mathml",children:s.jsx(e.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:s.jsxs(e.semantics,{children:[s.jsx(e.mrow,{children:s.jsxs(e.msub,{children:[s.jsx(e.mi,{children:"C"}),s.jsxs(e.mrow,{children:[s.jsx(e.mo,{children:"−"}),s.jsx(e.mn,{children:"1"})]})]})}),s.jsx(e.annotation,{encoding:"application/x-tex",children:"C_{-1}"})]})})}),s.jsx(e.span,{className:"katex-html","aria-hidden":"true",children:s.jsxs(e.span,{className:"base",children:[s.jsx(e.span,{className:"strut",style:{height:"0.8917em",verticalAlign:"-0.2083em"}}),s.jsxs(e.span,{className:"mord",children:[s.jsx(e.span,{className:"mord mathnormal",style:{marginRight:"0.07153em"},children:"C"}),s.jsx(e.span,{className:"msupsub",children:s.jsxs(e.span,{className:"vlist-t vlist-t2",children:[s.jsxs(e.span,{className:"vlist-r",children:[s.jsx(e.span,{className:"vlist",style:{height:"0.3011em"},children:s.jsxs(e.span,{style:{top:"-2.55em",marginLeft:"-0.0715em",marginRight:"0.05em"},children:[s.jsx(e.span,{className:"pstrut",style:{height:"2.7em"}}),s.jsx(e.span,{className:"sizing reset-size6 size3 mtight",children:s.jsxs(e.span,{className:"mord mtight",children:[s.jsx(e.span,{className:"mord mtight",children:"−"}),s.jsx(e.span,{className:"mord mtight",children:"1"})]})})]})}),s.jsx(e.span,{className:"vlist-s",children:"​"})]}),s.jsx(e.span,{className:"vlist-r",children:s.jsx(e.span,{className:"vlist",style:{height:"0.2083em"},children:s.jsx(e.span,{})})})]})})]})]})})]})," is always 0."]}),`
`,s.jsx(e.p,{children:"Let's print a few outputs:"}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-plain",children:`z00 = (x00 ^ y00)
z01 = ((x00 & y00) ^ (x01 ^ y01))
z02 = ((((x00 & y00) & (x01 ^ y01)) | (x01 & y01)) ^ (x02 ^ y02))
z03 = ((((((x00 & y00) & (x01 ^ y01)) | (x01 & y01)) & (x02 ^ y02)) | (x02 & y02)) ^ (x03 ^ y03))
`})}),`
`,s.jsxs(e.p,{children:["Take ",s.jsx(e.code,{children:"z02"})," as an example. From the mathematical formula, we know that ",s.jsx(e.code,{children:"z02 = x02 ^ y02 ^ C01"}),", where ",s.jsx(e.code,{children:"C01 = (x01 & y01) | (C00 & (x01 ^ y01))"}),", where ",s.jsx(e.code,{children:"C00 = x00 & y00"}),". This matches the actual printed output, so it looks like ",s.jsx(e.code,{children:"z02"}),"'s structure is as expected."]}),`
`,s.jsx(e.p,{children:"More generally, it appears that each full adder has the following structure (because of commutativity, the two operands' order may change, but the order of operations is the same):"}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-plain",children:`foo[n] = xn ^ yn
zn = carry[n-1] ^ foo[n]
bar[n] = xn & yn
baz[n] = carry[n-1] & foo[n]
carry[n] = baz[n] | bar[n]
`})}),`
`,s.jsx(e.p,{children:"The first adder, a half adder, has this structure:"}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-plain",children:`z00 = x00 ^ y00
carry[0] = x00 & y00
`})}),`
`,s.jsxs(e.p,{children:["The last adder is a full adder, but its ",s.jsx(e.code,{children:"carry44"})," output is labeled ",s.jsx(e.code,{children:"z45"})," instead."]}),`
`,s.jsx(e.p,{children:"But now we know that some gate labels are swapped, meaning that, while the right-hand side is accurate about the structure of the circuit, the left-hand side may be swapped. For example, the real data may say this:"}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-plain",children:`!! Bad labels !!

bar[n] = xn ^ yn
zn = carry[n-1] ^ foo[n]
foo[n] = xn & yn
baz[n] = carry[n-1] & foo[n]
carry[n] = baz[n] | bar[n]
`})}),`
`,s.jsxs(e.p,{children:["By swapping ",s.jsx(e.code,{children:"foo[n]"})," and ",s.jsx(e.code,{children:"bar[n]"}),", if we see ",s.jsx(e.code,{children:"abc = xn ^ yn"}),", and we just naïvely assume that ",s.jsx(e.code,{children:"abc"})," is ",s.jsx(e.code,{children:"foo[n]"}),", then we would be surprised that we never see ",s.jsx(e.code,{children:"carry[n-1] ^ abc"})," anywhere, because actually ",s.jsx(e.code,{children:"abc"})," is ",s.jsx(e.code,{children:"bar[n]"}),". Now the question is, what ",s.jsx(e.em,{children:"do"})," we know? What can we be certain about?"]}),`
`,s.jsxs(e.ul,{children:[`
`,s.jsxs(e.li,{children:["First, because ",s.jsx(e.code,{children:"n"})," goes from 0 to 44, we know that there are 44 full adders and 1 half adder, so 44 OR gates, 89 XOR gates, and 89 AND gates."]}),`
`,s.jsxs(e.li,{children:["We also know that the ",s.jsx(e.em,{children:"operands"})," of each gate are correct, so for example if we know the correct mapping for ",s.jsx(e.code,{children:"carry[n-1]"}),", then the operand it ANDs and XORs with must be ",s.jsx(e.code,{children:"foo[n]"}),"."]}),`
`,s.jsxs(e.li,{children:['Certain "swaps" are immaterial. For example, ',s.jsx(e.code,{children:"carry[n-1]"})," and ",s.jsx(e.code,{children:"foo[n]"})," are always used together, so swapping their labels do not change the meaning at all. Similarly, ",s.jsx(e.code,{children:"bar[n]"})," and ",s.jsx(e.code,{children:"baz[n]"})," are equivalent label-wise."]}),`
`]}),`
`,s.jsxs(e.p,{children:["However, this is about the information that the right-hand side in isolation can tell us: that a label belongs to the ",s.jsx(e.code,{children:"carry[n-1]"}),"/",s.jsx(e.code,{children:"foo[n]"})," group or the ",s.jsx(e.code,{children:"bar[n]"}),"/",s.jsx(e.code,{children:"baz[n]"}),' group. It does not tell us exactly which one it is. To do so, we must take the potentially-faulty left-hand side into consideration. Fear not, there are only very few faulty lines, and if we can immediately tell which ones are "suspicious", we can safely trust the rest to give us the extra information.']}),`
`,s.jsxs(e.p,{children:['We can start by categorizing each label as "',s.jsx(e.code,{children:"carry"})," or ",s.jsx(e.code,{children:"foo"}),'" or "',s.jsx(e.code,{children:"bar"})," or ",s.jsx(e.code,{children:"baz"}),'".']}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-ocaml",children:`let carry_or_foo, baz_or_bar =
  Hashtbl.fold
    (fun _ (x, op, y) (carry_or_foo, baz_or_bar) ->
      if
        (op = "XOR" || op = "AND")
        && (not (String.starts_with ~prefix:"x" x))
        && not (String.starts_with ~prefix:"y" x)
      then (carry_or_foo |> GateSet.add x |> GateSet.add y, baz_or_bar)
      else if op = "OR" then
        (carry_or_foo, baz_or_bar |> GateSet.add x |> GateSet.add y)
      else (carry_or_foo, baz_or_bar))
    gates
    (GateSet.empty, GateSet.empty)
`})}),`
`,s.jsx(e.p,{children:'Using these, we can extract the "suspicious" lines. A line is not suspicious if it follows the template given above:'}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-plain",children:`foo[n] = xn ^ yn
zn = carry[n-1] ^ foo[n]
bar[n] = xn & yn
baz[n] = carry[n-1] & foo[n]
carry[n] = baz[n] | bar[n]

==>

carry_or_foo = xn ^ yn
zn = carry_or_foo ^ carry_or_foo
baz_or_bar = xn & yn
baz_or_bar = carry_or_foo & carry_or_foo
carry_or_foo = baz_or_bar | baz_or_bar
`})}),`
`,s.jsx(e.pre,{children:s.jsx(e.code,{className:"language-ocaml",children:`let is_expected_gate k x op y carry_or_foo baz_or_bar =
  (* First does not receive carry *)
  (op = "XOR" && (x = "x00" || x = "y00") && k = "z00")
  || (op = "AND" && (x = "x00" || x = "y00") && GateSet.mem k carry_or_foo)
  || op = "XOR"
     && (String.starts_with ~prefix:"x" x || String.starts_with ~prefix:"y" x)
     && GateSet.mem k carry_or_foo
  || op = "XOR" && GateSet.mem x carry_or_foo && GateSet.mem y carry_or_foo
     && String.starts_with ~prefix:"z" k
  || op = "AND"
     && (String.starts_with ~prefix:"x" x || String.starts_with ~prefix:"y" x)
     && GateSet.mem k baz_or_bar
  || op = "AND" && GateSet.mem x carry_or_foo && GateSet.mem y carry_or_foo
     && GateSet.mem k baz_or_bar
  || op = "OR" && GateSet.mem x baz_or_bar && GateSet.mem y baz_or_bar
     (* Last does not have carry[44]; instead z45 *)
     && (GateSet.mem k carry_or_foo || k = "z45")
`})}),`
`,s.jsxs(e.p,{children:["I did not see this coming but the list of unexpected gates turns out to contain exactly 8 lines...? After all, there could both be false negatives because, for example, ",s.jsx(e.code,{children:"foo[10]"})," and ",s.jsx(e.code,{children:"foo[11]"})," could be swapped, which would not be detected by this logic."]}),`
`,s.jsxs(e.p,{children:["Also! I don't even have to know ",s.jsx(e.em,{children:"which"})," pairs are swapped, because the problem asks to sort them all together. So I just literally print these."]}),`
`,s.jsx(e.p,{children:"Perhaps a bulk of the analysis above isn't necessary for this problem; I would challenge anyone to make a fully generic anomaly detection algorithm that works with the false negatives mentioned above."}),`
`,s.jsx(r,{frontMatter:n})]})}function d(a={}){const{wrapper:e}={...i(),...a.components};return e?s.jsx(e,{...a,children:s.jsx(l,{...a})}):l(a)}export{d as default,n as frontMatter};
