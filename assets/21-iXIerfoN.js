import{u as N,j as e}from"./index-Plw_Q2wT.js";import{C as m}from"./index-B3KbZ4n0.js";import{P as u,a as w}from"./_components-CyBHRtnE.js";import"./_commonjsHelpers-Cpj98o6Y.js";const f="/assets/21-map-BXBUlUH5.png",x={tags:["BFS/DFS","Puzzle","Manual inspection","Geometry"],title:"Advent of Code 2023 - Day 21: Step Counter",description:"Advent of Code 2023 - Day 21: Step Counter, a problem that involves BFS/DFS, Puzzle, Manual inspection, and Geometry. Solution written in R, with detailed walkthrough and proof.",year:2023,day:21};function g(c){const s={annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",p:"p",pre:"pre",semantics:"semantics",span:"span",ul:"ul",...N(),...c.components};return e.jsxs(e.Fragment,{children:[e.jsxs(s.h1,{children:["Advent of Code 2023 - Day 21",e.jsx(s.span,{className:"subtitle",children:"Step Counter"})]}),`
`,`
`,e.jsx(u,{frontMatter:x}),`
`,e.jsx(s.h2,{children:"Part 1"}),`
`,e.jsx(s.p,{children:"Part 1 is a straightforward BFS, stopping when the distance is 64. However, since we can't do BFS for part 2, we might as well think about smarter solutions for part 1."}),`
`,e.jsxs(s.p,{children:["If we mark all cells that are reachable in exactly ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"t"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6151em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"})]})})]})," steps (allowing revisits), we see two patterns:"]}),`
`,e.jsxs(s.ul,{children:[`
`,e.jsxs(s.li,{children:["They form a checkerboard pattern, with certain cells only reachable in odd steps and others only reachable in even steps. This is because if we first reach a cell at time ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"t"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6151em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"})]})})]}),", then we can only return to it in even steps."]}),`
`,e.jsxs(s.li,{children:["The ",e.jsx(s.em,{children:"farthest"})," cells are bounded by a diamond shape with radius ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"t"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6151em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"})]})})]}),". This is because the shortest path to a cell is the Manhattan distance."]}),`
`]}),`
`,e.jsx(s.p,{children:"Consider the example map. Here, I marked all cells reachable in exactly 5 steps and exactly 4 steps."}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{const n=`...........
.....###.#.
.###.##..#.
..#.#...#..
....#.#....
.##..S####.
.##..#...#.
.......##..
.##.#.####.
.##..##.##.
...........`.split(`
`);a.strokeStyle="#80808060";for(let i=0;i<=n.length;i++)a.beginPath(),a.moveTo(0,i*30),a.lineTo(n[0].length*30,i*30),a.stroke();for(let i=0;i<=n[0].length;i++)a.beginPath(),a.moveTo(i*30,0),a.lineTo(i*30,n.length*30),a.stroke();for(let i=0;i<n.length;i++)for(let h=0;h<n[i].length;h++){const j=n[i][h];j==="#"?(a.fillStyle=r==="dark"?"#C0C0C0":"#404040",a.fillRect(h*30,i*30,30,30)):j==="S"&&(a.fillStyle="red",a.fillRect(h*30,i*30,30,30))}const l=[[4,5],[5,4],[3,4],[3,6],[4,7],[6,3],[1,4],[2,7],[3,8],[5,8],[6,7],[7,4],[7,2]],p=[[4,6],[5,3],[3,5],[3,7],[5,7],[7,3]];a.fillStyle="#39CAC480",l.forEach(([i,h])=>{a.fillRect(i*30,h*30,30,30)}),a.fillStyle="#CA7D3980",p.forEach(([i,h])=>{a.fillRect(i*30,h*30,30,30)}),a.lineWidth=2,a.strokeStyle="#39CAC4",a.beginPath(),a.moveTo(5.5*30,.5*30),a.lineTo(10.5*30,5.5*30),a.lineTo(5.5*30,10.5*30),a.lineTo(.5*30,5.5*30),a.closePath(),a.stroke(),a.strokeStyle="#CA7D39",a.beginPath(),a.moveTo(5.5*30,1.5*30),a.lineTo(9.5*30,5.5*30),a.lineTo(5.5*30,9.5*30),a.lineTo(1.5*30,5.5*30),a.closePath(),a.stroke()},width:340,height:340}),`
`,e.jsxs(s.p,{children:["Unfortunately, in this input, it is only guaranteed that ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"t"}),e.jsx(s.mo,{children:"≥"}),e.jsx(s.mi,{children:"d"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t\\ge d"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.7719em",verticalAlign:"-0.136em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:"≥"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6944em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"})]})]})]})," where ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"d"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"d"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6944em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"})]})})]})," is the Manhattan distance and ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"t"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6151em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"})]})})]})," is the first time when we reach the cell. So we can't just count the number of cells in the diamond shape. But! In the real input, it happens that for all ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"t"}),e.jsx(s.mo,{children:"="}),e.jsx(s.mn,{children:"64"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t=64"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6151em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:"="}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"64"})]})]})]})," cells, ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"d"}),e.jsx(s.mo,{children:"="}),e.jsx(s.mn,{children:"64"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"d=64"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6944em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:"="}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"64"})]})]})]})," as well. If we think about in what cases can ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"t"}),e.jsx(s.mo,{children:">"}),e.jsx(s.mi,{children:"d"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t > d"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6542em",verticalAlign:"-0.0391em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:">"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6944em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"})]})]})]}),", it would be when we have to take a detour around an obstacle; more precisely:"]}),`
`,e.jsxs(s.ul,{children:[`
`,e.jsxs(s.li,{children:[`
`,e.jsxs(s.p,{children:["If the cell is on the same row or column as the start, then any rock between the start and the cell would force us to take a detour, so ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"t"}),e.jsx(s.mo,{children:">"}),e.jsx(s.mi,{children:"d"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"t > d"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6542em",verticalAlign:"-0.0391em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"t"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:">"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6944em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"})]})]})]}),":"]}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{a.fillStyle="red",a.fillRect(0,35,30,30),a.fillStyle=r==="dark"?"#C0C0C0":"#404040",a.fillRect(135,35,30,30),a.beginPath(),a.moveTo(15,50),a.lineTo(120,50),a.lineTo(120,20),a.lineTo(180,20),a.lineTo(180,50),a.lineTo(250,50),a.stroke(),a.fillStyle=t,a.beginPath(),a.moveTo(250,55),a.lineTo(250,45),a.lineTo(260,50),a.fill(),a.textBaseline="middle",a.font="20px serif",a.fillText("t > d",270,50)},width:320,height:100}),`
`]}),`
`,e.jsxs(s.li,{children:[`
`,e.jsxs(s.p,{children:["If the cell is not on the same row or column as the start, then we can directly go to the cell in ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"d"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"d"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6944em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"})]})})]})," steps as long as either of its neighbors closer to the start is reachable in ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"d"}),e.jsx(s.mo,{children:"−"}),e.jsx(s.mn,{children:"1"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"d-1"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.7778em",verticalAlign:"-0.0833em"}}),e.jsx(s.span,{className:"mord mathnormal",children:"d"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),e.jsx(s.span,{className:"mbin",children:"−"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"1"})]})]})]})," steps. More generally, a diagonal line of rocks creates a triangular region behind it that requires a detour:"]}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{a.fillStyle="red",a.fillRect(0,100,30,30),a.fillStyle=r==="dark"?"#C0C0C0":"#404040",a.fillRect(90,70,30,30),a.fillRect(60,40,30,30),a.beginPath(),a.moveTo(15,115),a.lineTo(45,115),a.lineTo(45,25),a.lineTo(105,25),a.lineTo(105,55),a.moveTo(15,115),a.lineTo(135,115),a.lineTo(135,55),a.lineTo(105,55),a.stroke(),a.fillStyle=t,a.beginPath(),a.moveTo(100,45),a.lineTo(110,45),a.lineTo(105,55),a.moveTo(115,50),a.lineTo(115,60),a.lineTo(105,55),a.fill(),a.textBaseline="middle",a.font="20px serif",a.fillText("t > d",120,50),a.fillStyle="red",a.fillRect(200,100,30,30),a.fillStyle=r==="dark"?"#C0C0C0":"#404040",a.fillRect(290,70,30,30),a.fillStyle=t,a.beginPath(),a.moveTo(215,115),a.lineTo(275,115),a.lineTo(275,55),a.lineTo(305,55),a.stroke(),a.beginPath(),a.moveTo(295,50),a.lineTo(295,60),a.lineTo(305,55),a.fill(),a.textAlign="center",a.fillText("t = d",300,40)},width:400,height:200}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{a.fillStyle="red",a.fillRect(7.5,147.5,5,5),a.lineWidth=2,a.beginPath(),a.moveTo(20,20),a.lineTo(120,120),a.stroke(),a.fillStyle=r==="dark"?"#C0C0C040":"#40404040",a.beginPath(),a.moveTo(20,20),a.lineTo(120,20),a.lineTo(120,120),a.fill(),a.lineWidth=1,a.beginPath(),a.moveTo(10,150),a.lineTo(10,15),a.lineTo(100,15),a.stroke(),a.fillStyle=t,a.beginPath(),a.moveTo(100,15),a.lineTo(90,10),a.lineTo(90,20),a.fill()},width:200,height:200}),`
`]}),`
`]}),`
`,e.jsx(s.p,{children:`For the real input, no rocks are placed on the same row or column as the start, and very few rocks are placed diagonally. Furthermore, there's a diamond-shaped all empty region inscribed by the map, in which absolutely no rocks exist, which acts as buffer room allowing any detours to be "smoothed out":`}),`
`,e.jsx(s.p,{children:e.jsx(s.img,{src:f,alt:"Map",width:254,height:550})}),`
`,e.jsxs(s.p,{children:["Anyway, the conclusion is that whenever a cell is inside the diamond with radius 64, it is reachable in 64 steps, no exceptions. It is reachable in ",e.jsx(s.em,{children:"exactly"})," 64 steps with the additional condition that it's an even cell (i.e., its Manhattan distance from the start is even)."]}),`
`,e.jsx(s.pre,{children:e.jsx(s.code,{className:"language-R",children:`dist <- abs(row(mat) - start[1]) + abs(col(mat) - start[2])
reachable <- bfs(mat, start)
res <- sum(reachable & (dist <= 64) & (dist %% 2 == 0))
`})}),`
`,e.jsxs(s.p,{children:["In fact, had the map be ",e.jsx(s.em,{children:"slightly"})," nicer, we might actually be able to replace the ",e.jsx(s.code,{children:"bfs"})," entirely with ",e.jsx(s.code,{children:'mat != "#"'}),". The only reason we need to do BFS is that some cells are entirely surrounded by rocks and thus unreachable."]}),`
`,e.jsx(s.h2,{children:"Part 2"}),`
`,e.jsxs(s.p,{children:["If there was any doubt in part 1, part 2 confirms that brute-force BFS can't work and we must look for patterns. We now bump up the problem one scale, so instead of a grid of discrete cells, we consider a grid of ",e.jsx(s.em,{children:"matrices"}),", each one with the same shape as the original map."]}),`
`,e.jsxs(s.p,{children:["First, the parity condition still holds: there are cells that are only reachable in odd steps and cells that are only reachable in even steps. Because the matrix width and height are both 131, an odd number, the parity of the same cell alternates between odd and even as we move from one matrix to the next. For example, if ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mo,{stretchy:"false",children:"("}),e.jsx(s.mi,{children:"x"}),e.jsx(s.mo,{separator:"true",children:","}),e.jsx(s.mi,{children:"y"}),e.jsx(s.mo,{stretchy:"false",children:")"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"(x, y)"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),e.jsx(s.span,{className:"mopen",children:"("}),e.jsx(s.span,{className:"mord mathnormal",children:"x"}),e.jsx(s.span,{className:"mpunct",children:","}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),e.jsx(s.span,{className:"mclose",children:")"})]})})]})," is an odd cell, then when we move to the matrix to its right, ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mo,{stretchy:"false",children:"("}),e.jsx(s.mi,{children:"x"}),e.jsx(s.mo,{children:"+"}),e.jsx(s.mn,{children:"131"}),e.jsx(s.mo,{separator:"true",children:","}),e.jsx(s.mi,{children:"y"}),e.jsx(s.mo,{stretchy:"false",children:")"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"(x + 131, y)"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),e.jsx(s.span,{className:"mopen",children:"("}),e.jsx(s.span,{className:"mord mathnormal",children:"x"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),e.jsx(s.span,{className:"mbin",children:"+"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),e.jsx(s.span,{className:"mord",children:"131"}),e.jsx(s.span,{className:"mpunct",children:","}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),e.jsx(s.span,{className:"mclose",children:")"})]})]})]})," is an even cell. This means that ",e.jsx(s.em,{children:"matrices"})," also have parity, measured by the Manhattan distance in matrices from the starting matrix to it, and the real parity of a cell is the parity of the matrix plus the parity of the cell within the starting matrix. The starting matrix is even because it has 0 distance from itself."]}),`
`,e.jsx(s.p,{children:"Now let's consider a diamond with radius 26501365, overlaid on this grid of matrices (remember that the diamond cuts through the diagonal of matrix cells like in part 1, but because we have zoomed out here, it appears as if the points are continuous)."}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{for(let l=0;l<9;l++)for(let p=0;p<9;p++)a.fillStyle=(l+p)%2===0?"#CA7D3980":"#39CAC480",a.fillRect(p*40,l*40,40,40);a.strokeStyle="#80808060";for(let l=0;l<=9;l++)a.beginPath(),a.moveTo(0,l*40),a.lineTo(360,l*40),a.stroke();for(let l=0;l<=9;l++)a.beginPath(),a.moveTo(l*40,0),a.lineTo(l*40,360),a.stroke();a.fillStyle="red",a.fillRect(178,178,4,4),a.lineWidth=2,a.strokeStyle=t,a.beginPath(),a.moveTo(180,0),a.lineTo(360,180),a.lineTo(180,360),a.lineTo(0,180),a.closePath(),a.stroke()},width:370,height:370}),`
`,e.jsxs(s.p,{children:["The number ",e.jsx(s.code,{children:"26501365"})," is no accident: ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mn,{children:"26501365"}),e.jsx(s.mo,{children:"="}),e.jsx(s.mn,{children:"65"}),e.jsx(s.mo,{children:"+"}),e.jsx(s.mn,{children:"131"}),e.jsx(s.mo,{children:"×"}),e.jsx(s.mn,{children:"202300"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"26501365 = 65 + 131\\times 202300"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"26501365"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:"="}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.7278em",verticalAlign:"-0.0833em"}}),e.jsx(s.span,{className:"mord",children:"65"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),e.jsx(s.span,{className:"mbin",children:"+"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.7278em",verticalAlign:"-0.0833em"}}),e.jsx(s.span,{className:"mord",children:"131"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),e.jsx(s.span,{className:"mbin",children:"×"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"202300"})]})]})]}),", meaning that we can first travel to the border of the starting matrix in 65 steps, and then travel 202300 (an even number) matrices. So the above diagram is accurate in that eventually the corner of the diamond should touch the edge of an orange (even) matrix. Now we need to count the number of odd cells in this diamond, which requires counting 4 things:"]}),`
`,e.jsxs(s.ul,{children:[`
`,e.jsx(s.li,{children:"The number of more than half-covered odd matrices (the cyan ones), and the number of even cells (as defined in the starting matrix) in each one."}),`
`,e.jsx(s.li,{children:"The number of more than half-covered even matrices (the orange ones), and the number of odd cells (as defined in the starting matrix) in each one."}),`
`,e.jsx(s.li,{children:"Add the even cells from the little cyan triangles on the inside of the diamond's border."}),`
`,e.jsx(s.li,{children:"Subtract the odd cells from the little orange triangles on the outside of the diamond's border."}),`
`]}),`
`,e.jsx(s.p,{children:"Calculation of numbers of even and odd cells in a whole matrix is the same as before:"}),`
`,e.jsx(s.pre,{children:e.jsx(s.code,{className:"language-R",children:`dist <- abs(row(mat) - start[1]) + abs(col(mat) - start[2])
is_even <- dist %% 2 == 0
reachable <- bfs(mat, start)
even_cells_in_mat <- as.bigz(sum(is_even & reachable))
odd_cells_in_mat <- as.bigz(sum(!is_even & reachable))
`})}),`
`,e.jsxs(s.p,{children:["In the diagram above, the diamond has a radius of 4 matrices, and includes 25 orange matrices and 16 cyan matrices (you can see this more clearly if you turn your head 45 degrees, and you can see that the orange matrices and cyan matrices form two lattices). Therefore, with ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"R"}),e.jsx(s.mo,{children:"="}),e.jsx(s.mn,{children:"202300"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"R=202300"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6833em"}}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),e.jsx(s.span,{className:"mrel",children:"="}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"202300"})]})]})]}),", we have ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mo,{stretchy:"false",children:"("}),e.jsx(s.mi,{children:"R"}),e.jsx(s.mo,{children:"+"}),e.jsx(s.mn,{children:"1"}),e.jsxs(s.msup,{children:[e.jsx(s.mo,{stretchy:"false",children:")"}),e.jsx(s.mn,{children:"2"})]})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"(R+1)^2"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),e.jsx(s.span,{className:"mopen",children:"("}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),e.jsx(s.span,{className:"mbin",children:"+"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"1.0641em",verticalAlign:"-0.25em"}}),e.jsx(s.span,{className:"mord",children:"1"}),e.jsxs(s.span,{className:"mclose",children:[e.jsx(s.span,{className:"mclose",children:")"}),e.jsx(s.span,{className:"msupsub",children:e.jsx(s.span,{className:"vlist-t",children:e.jsx(s.span,{className:"vlist-r",children:e.jsx(s.span,{className:"vlist",style:{height:"0.8141em"},children:e.jsxs(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[e.jsx(s.span,{className:"pstrut",style:{height:"2.7em"}}),e.jsx(s.span,{className:"sizing reset-size6 size3 mtight",children:e.jsx(s.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})]})]})," orange (even) matrices and ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsxs(s.msup,{children:[e.jsx(s.mi,{children:"R"}),e.jsx(s.mn,{children:"2"})]})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"R^2"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.8141em"}}),e.jsxs(s.span,{className:"mord",children:[e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),e.jsx(s.span,{className:"msupsub",children:e.jsx(s.span,{className:"vlist-t",children:e.jsx(s.span,{className:"vlist-r",children:e.jsx(s.span,{className:"vlist",style:{height:"0.8141em"},children:e.jsxs(s.span,{style:{top:"-3.063em",marginRight:"0.05em"},children:[e.jsx(s.span,{className:"pstrut",style:{height:"2.7em"}}),e.jsx(s.span,{className:"sizing reset-size6 size3 mtight",children:e.jsx(s.span,{className:"mord mtight",children:"2"})})]})})})})})]})]})})]})," cyan (odd) matrices."]}),`
`,e.jsx(s.p,{children:"The next step is to add the cyan triangles and subtract the orange triangles. Let's zoom in to see what one of them looks like. Remember that here each cell is an actual cell, not a matrix, although the colors still mark matrix parity. I've highlighted the cyan cells that need to be included and orange cells that need to be excluded."}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{for(let n=0;n<2;n++)for(let l=0;l<2;l++)a.fillStyle=(n+l)%2!==0?"#CA7D3980":"#39CAC480",a.fillRect(l*135,n*135,135,135);a.strokeStyle="#80808060";for(let n=0;n<=18;n++)a.beginPath(),a.moveTo(0,n*15),a.lineTo(270,n*15),a.stroke();for(let n=0;n<=18;n++)a.beginPath(),a.moveTo(n*15,0),a.lineTo(n*15,270),a.stroke();a.fillStyle="#CA7D39";for(const n of[[9,0],[10,0],[11,0],[12,0],[9,1],[10,1],[11,1],[9,2],[10,2],[9,3],[0,9],[1,9],[2,9],[3,9],[0,10],[1,10],[2,10],[0,11],[1,11],[0,12],[0,14],[0,15],[1,15],[0,16],[1,16],[2,16],[0,17],[1,17],[2,17],[3,17]])a.fillRect(n[0]*15,n[1]*15,15,15);a.fillStyle="#39CAC4";for(const n of[[8,6],[8,7],[8,8],[7,7],[7,8],[6,8]])a.fillRect(n[0]*15,n[1]*15,15,15);a.strokeStyle=t,a.lineWidth=2,a.beginPath(),a.moveTo(75,270),a.lineTo(7.5,135*1.5),a.lineTo(210,0),a.stroke()},width:300,height:300}),`
`,e.jsxs(s.p,{children:["If we look at the diamond as a whole, we notice that if the diamond has radius ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"R"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"R"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6833em"}}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"})]})})]})," (again measured in matrices), then there are ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsxs(s.mrow,{children:[e.jsx(s.mi,{children:"R"}),e.jsx(s.mo,{children:"+"}),e.jsx(s.mn,{children:"1"})]}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"R+1"})]})})}),e.jsxs(s.span,{className:"katex-html","aria-hidden":"true",children:[e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.7667em",verticalAlign:"-0.0833em"}}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),e.jsx(s.span,{className:"mbin",children:"+"}),e.jsx(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6444em"}}),e.jsx(s.span,{className:"mord",children:"1"})]})]})]})," orange triangles for each of upper-left, upper-right, lower-left, and lower-right, as well as ",e.jsxs(s.span,{className:"katex",children:[e.jsx(s.span,{className:"katex-mathml",children:e.jsx(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:e.jsxs(s.semantics,{children:[e.jsx(s.mrow,{children:e.jsx(s.mi,{children:"R"})}),e.jsx(s.annotation,{encoding:"application/x-tex",children:"R"})]})})}),e.jsx(s.span,{className:"katex-html","aria-hidden":"true",children:e.jsxs(s.span,{className:"base",children:[e.jsx(s.span,{className:"strut",style:{height:"0.6833em"}}),e.jsx(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"})]})})]})," cyan triangles for each of these four corners. If we pack these corners into the same matrix, and then only take the even cells from the cyan triangles and odd cells from the orange triangles, it looks like this:"]}),`
`,e.jsx(m,{code:(a,o,d,t,r)=>{a.strokeStyle="#80808060";for(let n=0;n<=9;n++)a.beginPath(),a.moveTo(0,n*15),a.lineTo(135,n*15),a.stroke();for(let n=0;n<=9;n++)a.beginPath(),a.moveTo(n*15,0),a.lineTo(n*15,135),a.stroke();for(let n=0;n<=9;n++)a.beginPath(),a.moveTo(200,n*15),a.lineTo(335,n*15),a.stroke();for(let n=0;n<=9;n++)a.beginPath(),a.moveTo(n*15+200,0),a.lineTo(n*15+200,135),a.stroke();a.font="20px serif",a.textAlign="center",a.textBaseline="middle",a.fillText("×(R+1)",15*4.5,150),a.fillText("×R",15*4.5+200,150),a.fillStyle="#CA7D39";for(const n of[[0,0],[1,0],[2,0],[3,0],[0,1],[1,1],[2,1],[0,2],[1,2],[0,3],[0,5],[0,6],[1,6],[0,7],[1,7],[2,7],[0,8],[1,8],[2,8],[3,8],[5,0],[6,0],[7,0],[8,0],[6,1],[7,1],[8,1],[7,2],[8,2],[8,3],[8,5],[7,6],[8,6],[6,7],[7,7],[8,7],[5,8],[6,8],[7,8],[8,8]])(n[0]+n[1])%2!==0&&a.fillRect(n[0]*15,n[1]*15,15,15);a.fillStyle="#39CAC4";for(const n of[[0,0],[1,0],[2,0],[0,1],[1,1],[0,2],[0,6],[0,7],[1,7],[0,8],[1,8],[2,8],[6,0],[7,0],[8,0],[7,1],[8,1],[8,2],[8,6],[7,7],[8,7],[6,8],[7,8],[8,8]])(n[0]+n[1])%2===0&&a.fillRect(n[0]*15+200,n[1]*15,15,15)},width:350,height:170}),`
`,e.jsxs(s.p,{children:["The union of the orange and cyan triangles is exactly the corners that are outside a diamond inscribed in the matrix (remember that R is 1-indexed; if this is 0-indexed then the condition should be ",e.jsx(s.code,{children:"dist > start[0]"})," instead):"]}),`
`,e.jsx(s.pre,{children:e.jsx(s.code,{className:"language-R",children:`is_corner <- dist >= start[1]
`})}),`
`,e.jsx(s.p,{children:"Now we can count the cyan cells (even cells in these corners) and orange cells (odd cells in these corners):"}),`
`,e.jsx(s.pre,{children:e.jsx(s.code,{className:"language-R",children:`even_corners_in_mat <- as.bigz(sum(is_corner & is_even & reachable))
odd_corners_in_mat <- as.bigz(sum(is_corner & !is_even & reachable))
`})}),`
`,e.jsx(s.p,{children:"Finally, we can put these together:"}),`
`,e.jsx(s.pre,{children:e.jsx(s.code,{className:"language-R",children:`mat_radius <- as.bigz((26501365 - (w - 1) / 2) / w)
total <- odd_cells_in_mat *
  (mat_radius + 1)^2 +
  even_cells_in_mat * mat_radius^2 +
  even_corners_in_mat * mat_radius -
  odd_corners_in_mat * (mat_radius + 1)
`})}),`
`,e.jsx(w,{frontMatter:x})]})}function T(c={}){const{wrapper:s}={...N(),...c.components};return s?e.jsx(s,{...c,children:e.jsx(g,{...c})}):g(c)}export{T as default,x as frontMatter};
